- if @product and @nature and @started_at and @stopped_at
  :ruby
    data = {}.with_indifferent_access
    for analysis in Analysis.where(nature: @nature.name, product: @product).between(@started_at, @stopped_at).order(:sampled_at)
      at = analysis.sampled_at.to_usec
      for item in analysis.items
        data[item.indicator.name] ||= []
        data[item.indicator.name] << [at, item.value.to_s.to_f]
      end
    end
    series = []
    for item in @nature.items
      item = Nomen::Indicators[item]
      series << {type: item.curve, name: item.human_name, data: data[item.name]}
    end

  = spline_chart(series, y_axis: {title: {text: :indicator_value.tl} , opposite: true}, x_axis: {type: 'datetime'}, legend: true)
- elsif @nature and @started_at and @stopped_at
  :ruby
    data = {}.with_indifferent_access
    for analysis in Analysis.where(nature: @nature.name).between(@started_at, @stopped_at).order(:sampled_at)
      at = analysis.sampled_at.to_usec
      for item in analysis.items
        data[item.indicator.name] ||= []
        data[item.indicator.name] << [at, item.value.to_s.to_f]
      end
    end
    series = []
    for item in @nature.items
      item = Nomen::Indicators[item]
      if item.unit
        unit_name_value = Nomen::Units[item.unit].human_name
        unit_name = " #{unit_name_value}"
      else
        unit_name = ""
      end
      series << {type: item.curve, name: item.human_name, data: data[item.name], tooltip: {value_suffix: unit_name , x_date_format: '%d/%m/%Y'}}
    end

  = spline_chart(series, y_axis: {title: {text: :indicator_value.tl}, opposite: true}, x_axis: {type: 'datetime'}, legend: true)
- else
  = no_data
